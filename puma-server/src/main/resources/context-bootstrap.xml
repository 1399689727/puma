<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:task="http://www.springframework.org/schema/task"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
    http://www.springframework.org/schema/task   
    http://www.springframework.org/schema/task/spring-task-3.0.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<bean name="placeholder" lazy-init="false"
		class="com.dianping.puma.config.InitializeConfig">
		<property name="propertiesPath" value="applicationContext.properties" />
	</bean>

	<!-- annotation scan -->
	<context:component-scan base-package="com.dianping.puma" />
    
    <task:annotation-driven />
      
	<!--bean id="serverConfig" class="com.dianping.puma.config.Config">
		<property name="port" value="8080" />
	</bean-->
	
	<!-- <import resource="serverConfig-${puma.server.env}.xml" /> -->
	
	<import resource="applicationContext-swallow.xml" />
	
	<bean id="notifyService" class="com.dianping.puma.core.monitor.DefaultNotifyService" />

	<bean id="notifiableBean" abstract="true">
		<property name="notifyService" ref="notifyService" />
	</bean>

	<bean id="statusReportTask" class="com.dianping.puma.reporter.StatusReportTask"
		parent="notifiableBean" init-method="start" />

	<bean id="dailyReportTask" class="com.dianping.puma.reporter.DailyReportTask"
		parent="notifiableBean" init-method="start" />

	<bean id="binlogInfoHolder"
		  class="com.dianping.puma.core.holder.impl.DefaultBinlogInfoHolder"
		  init-method="init">
		<property name="baseDir" value="/data/appdatas/puma/binlog/"/>
		<property name="bakDir" value="/data/appdatas/puma/binlog/bak/"/>
		<property name="storageBakDir" value="/data/appdatas/puma/bak/"/>
		<property name="masterStorageBaseDir" value="/data/appdatas/puma/storage/master/"/>
		<property name="slaveStorageBaseDir" value="/data/appdatas/puma/storage/slave/"/>
		<property name="binlogIndexBaseDir" value="/data/appdatas/puma/binlogIndex/"/>
	</bean>

	<bean id="binlogInfoBackup"
		  class="com.dianping.puma.core.storage.backup.LocalFileBasedBackup"
		  init-method="init">
		<property name="workingBaseFolder" value="/data/appdatas/puma/binlog/" />
		<property name="backupBaseFolder" value="/data/appdatas/puma/bak/binlog/" />
		<property name="backupDay" value="2" />
	</bean>

	<bean id="jsonCodec" class="com.dianping.puma.core.codec.JsonEventCodec" />

	<bean id="mongoClient" class="com.dianping.puma.core.dao.morphia.helper.MongoClient">
	</bean>

   <bean id="seqGeneratorService"
        class="com.dianping.puma.core.dao.morphia.helper.MongoSeqGeneratorServiceImpl">
        <property name="mongoClient">
            <ref bean="mongoClient" />
        </property>
        <property name="dbName" value="puma_admin" />
        <property name="collName" value="seq" />
    </bean>
	<!--
	<bean id="defaultSender" class="com.dianping.puma.sender.FileDumpSender">
		<property name="storage">
			<bean class="com.dianping.puma.storage.DefaultEventStorage">
				<property name="name" value="" />

				<property name="masterBucketIndex">
					<bean class="com.dianping.puma.storage.LocalFileBucketIndex">
						<property name="bucketFilePrefix" value=""/>
						<property name="maxBucketLengthMB" value="0"/>
						<property name="baseDir" value=""/>
					</bean>
				</property>
			</bean>
		</property>
	</bean>
    -->
	<!--bean id="mongoClient2" class="com.dianping.puma.core.dao.morphia.helper.MongoClient">
	</bean-->
	<task:scheduled-tasks>
        <task:scheduled ref="pumaMonitorSeqTask" method="runTask" fixed-delay="#{taskLionConfig.seqInterval}"/> 
    </task:scheduled-tasks>  
    <task:scheduled-tasks>
        <task:scheduled ref="pumaMonitorClientIpTask" method="runTask" fixed-delay="#{taskLionConfig.clientIpInterval}"/>  
    </task:scheduled-tasks>  
    <task:scheduled-tasks>
        <task:scheduled ref="pumaMonitorServerInfoTask" method="runTask" fixed-delay="#{taskLionConfig.serverInfoInterval}"/>   
    </task:scheduled-tasks>
    <task:scheduled-tasks>
        <task:scheduled ref="pumaMonitorSyncProcessTask" method="runTask" fixed-delay="#{taskLionConfig.syncProcessInterval}"/>   
    </task:scheduled-tasks>
   
</beans>


    