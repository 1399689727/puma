<script type="text/ng-template" id="target.html">
    <div class="modal-header">
        <h3 class="modal-title">{{item.name}}</h3>
    </div>
    <div class="modal-body">
        <ul>
            <li ng-repeat="table in item.target.tables | orderBy:'schemaName'">
                {{table.schemaName}}.{{table.tableName}}
            </li>
        </ul>
    </div>
</script>

<script type="text/ng-template" id="tables.html">
    <div class="modal-header">
        <h3 class="modal-title">{{item.name}}</h3>
    </div>
    <div class="modal-body">
        <ul>
            <li ng-repeat="table in item.tables | orderBy">
                {{table}}
            </li>
        </ul>
    </div>
</script>

<div ng-controller="pumaMonitorController">
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {}
        </script>
        <ul class="breadcrumb">
            <li>
                <i class="ace-icon fa fa-home home-icon"></i>
                <a href="#">Home</a>
            </li>
            <li class="active">Puma Monitor</li>
        </ul>
        <div class="nav-search" id="nav-search" style="padding-top:2px;">
            <input ng-model="autoRefresh" name="form-field-checkbox" class="ace ace-checkbox-2" type="checkbox">
            <span class="lbl">Auto Refresh</span>
        </div>
    </div>
    <div class="page-content">
        <div class="page-content-area">
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="widget-box">
                                <div class="widget-header widget-header-large">
                                    <h5 class="widget-title lighter">Puma Task Monitor</h5>
                                </div>
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <table role="grid" id="simple-table" class="table table-striped table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Server</th>
                                                    <th>Name</th>
                                                    <th>Store Qps</th>
                                                    <th>I / U / D / DDL</th>
                                                    <th>BinlogInfo</th>
                                                    <th>Target</th>
                                                    <th>Other</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="server in servers | orderBy:'server'">
                                                    <td>{{server.server}}</td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="top" data-content="Host : {{server.host}} <br />Port  : {{server.port}}">{{server.name}}</span></td>
                                                    <td>{{server.storeQps}}</td>
                                                    <td>{{server.totalInsertEvent}} / {{server.totalUpdateEvent}} / {{server.totalDeleteEvent}} / {{server.totalDdlEvent}}</td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="top" data-content="ServerId : {{server.binlogInfo.serverId}} <br />BinlogFile  : {{server.binlogInfo.binlogFile}} <br />BinlogPosition   : {{server.binlogInfo.binlogPosition }} <br />EventIndex   : {{server.binlogInfo.eventIndex }} <br />Timestamp   : {{server.binlogInfo.timestamp*1000 }}">{{server.binlogInfo.timestamp * 1000}}</span>
                                                    </td>
                                                    <td><a ng-click="openTarget(server)" data-html="true" data-toggle="popover" data-placement="top" data-content="{{server.targetStr}}">show</a></td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="left" data-content="BucketDate : {{server.bucketDate}} <br />BucketNumber : {{server.bucketNumber}} <br />TotalParsedEvent : {{server.totalParsedEvent}} <br />TotalStoreCount : {{server.totalStoreCount }} <br />TotalStoreBytes : {{server.totalStoreBytes}}">{{server.totalParsedEvent }}</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="widget-box">
                                <div class="widget-header widget-header-large">
                                    <h5 class="widget-title lighter">Puma Client Monitor</h5>
                                </div>
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <table role="grid" id="simple-table" class="table table-striped table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Server</th>
                                                    <th>Name</th>
                                                    <th>Remote</th>
                                                    <th>Fetch Qps</th>
                                                    <th>Target</th>
                                                    <th>SendBinlogInfo</th>
                                                    <th>AckBinlogInfo</th>
                                                    <th>Other</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="client in clients | orderBy:'server'">
                                                    <td>{{client.server}}</td>
                                                    <td>{{client.name}}</td>
                                                    <td>{{client.ip}}</td>
                                                    <td>{{client.fetchQps}}</td>
                                                    <td><a ng-click="openTables(client)" data-html="true" data-toggle="popover" data-placement="top" data-content="{{client.tablesStr}}">{{client.database}}</a></td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="top" data-content="ServerId : {{client.sendBinlogInfo.serverId}} <br />BinlogFile  : {{client.sendBinlogInfo.binlogFile}} <br />BinlogPosition   : {{client.sendBinlogInfo.binlogPosition }} <br />EventIndex   : {{client.sendBinlogInfo.eventIndex }} <br />Timestamp   : {{client.sendBinlogInfo.timestamp*1000 }}">{{client.sendBinlogInfo.timestamp * 1000}}</span></td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="top" data-content="ServerId : {{client.ackBinlogInfo.serverId}} <br />BinlogFile  : {{client.ackBinlogInfo.binlogFile}} <br />BinlogPosition   : {{client.ackBinlogInfo.binlogPosition }} <br />EventIndex   : {{client.ackBinlogInfo.eventIndex }} <br />Timestamp   : {{client.ackBinlogInfo.timestamp*1000 }}">{{client.ackBinlogInfo.timestamp * 1000}}</span></td>
                                                    <td><span data-html="true" data-toggle="popover" data-placement="left" data-content="Codec : {{client.codec}} <br />Dml : {{client.withDml}} <br />Dml : {{client.withDml}} <br />Transaction : {{client.withTransaction}}">{{client.codec}}</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>