<div class="container-fluid">
   <div class="panel panel-primary">
      <div class="panel-heading">
         <div class="btn-group-sm pull-right">
            <button class="btn btn-default" onclick="javascript:history.back();">取消</button>
            <button class="btn btn-success validation-button" type="submit" form="puma-task-create-form"
                    #if(${lock}) disabled="disabled" #end>保存</button>
         </div>
         <h5>
            新增数据处理任务
         </h5>
      </div>

      <form id="puma-task-create-form" class="form-horizontal puma-form" method="post"
            action="${rc.contextPath}/puma-task/create" target="${rc.contextPath}/puma-task">
         <div class="panel-body">

            <div class="form-group">
               <label class="col-md-2 control-label" for="srcDBInstanceName">源数据库</label>
               <div class="col-md-7">
                  <select id="srcDBInstanceName" name="srcDBInstanceName" class="form-control">
                     #foreach($srcDBInstance in ${srcDBInstanceEntities})
                     <option value="${srcDBInstance.name}"
                             #if(${entity}) #if(${entity.srcDBInstanceName} == ${srcDBInstance.name}) selected="selected" #else disabled="disabled" #end #end>
                        ${srcDBInstance.name}
                     </option>
                     #end
                  </select>
               </div>
               <div class="col-md-3" hidden="hidden">
                  <p class="help-block">hello</p>
               </div>
            </div>

            <div class="form-group">
               <label class="col-md-2 control-label" for="pumaServerName">数据处理服务器</label>
               <div class="col-md-7">
                  <select id="pumaServerName" name="pumaServerName" class="form-control">
                     #foreach($pumaServer in ${pumaServerEntities})
                     <option value="${pumaServer.name}"
                             #if(${entity}) #if(${entity.pumaServerName} == ${pumaServer.name}) selected="selected" #else disabled="disabled" #end #end>
                        ${pumaServer.name}
                     </option>
                     #end
                  </select>
               </div>
               <div class="col-md-3" hidden="hidden">
                  <p class="help-block">hello</p>
               </div>
            </div>

            <div class="form-group">
               <label class="col-md-2 control-label" for="name">任务名称</label>
               <div class="col-md-7">
                  <input id="name" name="name" class="form-control validation-input" format="puma-task-name"
                         #if(${entity}) value="${entity.name}" #end #if(${entity}) readonly="readonly" #end>
               </div>
               <div class="col-md-3 validation-help">
                  <span hidden="hidden">无效任务名称</span>
               </div>
            </div>

            <div class="form-group">
               <label class="col-md-2 control-label" for="binlogFile">数据库日志</label>
               <div class="col-md-5">
                  <input id="binlogFile" name="binlogFile" class="form-control validation-input"
                         format="bin-log-file" placeholder="文件名" #if(${entity}) value="${entity.binlogInfo.binlogFile}" #end>
               </div>

               <label class="sr-only" for="binlogPosition">数据库日志位置</label>
               <div class="col-md-2">
                  <input id="binlogPosition" name="binlogPosition" class="form-control validation-input"
                         format="bin-log-position" placeholder="位置" #if(${entity}) value="${entity.binlogInfo.binlogPosition}" #end>
               </div>
               <div class="col-md-3 validation-help">
                  <span hidden="hidden">无效数据库日志</span>
               </div>
            </div>

            <div class="form-group">
               <label class="col-md-2 control-label" for="preservedDay">数据存储天数</label>
               <div class="col-md-7">
                  <input id="preservedDay" name="preservedDay" class="form-control validation-input" format="day"
                         #if(${entity}) value="${entity.preservedDay}" #end>
               </div>
               <div class="col-md-3 validation-help">
                  <span hidden="hidden">无效数据存储天数</span>
               </div>
            </div>  
         </div>
           <div class="panel panel-default panel-local">
		       <div class="panel-heading">
		           <div class="btn-group-sm pull-right">
		           	<button class="btn btn-success" type="button" onclick="add_db_table(this);">新增数据库及表</button>
		           </div>
		           <h5>映射关系</h5>
		       </div>
		       <div class="panel-body" name="form_body_mapping">
		       #foreach($acceptedDataInfo in $entity.acceptedDataInfos.entrySet())
		       	<div>
		         <div class="form-group">
	               <label class="col-md-2 control-label" for="acceptedDatabase">处理数据库</label>
	               <div class="col-md-7">
	                  <input id="acceptedDatabase" name="acceptedDatabase" class="form-control"
	                         value="${acceptedDataInfo.key}">
	               </div>
	               <div class="col-md-3 validation-help">
	                  <span hidden="hidden">无效数据库名称</span>
	               </div>
            	 </div>  
				 <div class="form-group">
	               <label class="col-md-2 control-label" for="acceptedTable">数据库相关表</label>
	               <div class="col-md-7">
	               	#set ($strtbl = "")
	               	#foreach($tableName in $acceptedDataInfo.value.tables)
	               		#set($strtbl = $strtbl + $tableName + "&")
	               	#end
	               	#set($strtbl=$strtbl.trim())
	               	#if($strtbl.length() > 0)
	               		#set ($length = $strtbl.length() - 1)
	               		#set ($strtbl = $strtbl.substring(0,$length))
	               	#end
	               	<textarea id="acceptedTable" name="acceptedTable"class="form-control" rows="3" placeholder='tableName&tableName&tableName'>$strtbl</textarea>
	               </div>
	               <div class="col-sm-1">
					<a href="javascript:;" onclick="remove_db_table(this);" >
					<span class="glyphicon glyphicon-remove" aria-hidden="true"  style="margin-top:8px;"></span>
					</a>
				   </div>
	               <div class="col-md-2 validation-help">
				      <span hidden="hidden">无效的数据格式</span>
				    </div>
	           	</div>
	           	</div>
	           	#end
	           </div>
	       	</div>
      </form>
      
   </div>
</div>

<div style="display: none" id="copySource">
<div id="add_database_table_div">
	<div>
	<div class="form-group">
	  <label class="col-md-2 control-label" for="acceptedDatabase">处理数据库</label>
	    <div class="col-md-7">
	       <input id="acceptedDatabase" name="acceptedDatabase" class="form-control">
	    </div>
	    <div class="col-md-3 validation-help">
	      <span hidden="hidden">无效数据库名称</span>
	    </div>
     </div>  
	 <div class="form-group">
	    <label class="col-md-2 control-label" for="acceptedTable">数据库相关表</label>
	     <div class="col-md-7">
	       <textarea id="acceptedTable" name="acceptedTable"class="form-control" rows="3" placeholder='tableName,tableName,tableName'></textarea>
	     </div>
	     
	     <div class="col-sm-1">
			<a href="javascript:;" onclick="remove_db_table(this);" >
			<span class="glyphicon glyphicon-remove" aria-hidden="true"  style="margin-top:8px;"></span>
			</a>
		 </div>
	</div>
	</div>
</div>
</div>
<script>
	function add_db_table(aLink){
		var form = $(aLink).parent().parent().parent().children("div[name='form_body_mapping']");
		$(form).append($('#add_database_table_div').html());
	}

	function remove_db_table(aLink) {
		var control = $(aLink).parent().parent().parent();
		$(control).remove();
	}
</script>
