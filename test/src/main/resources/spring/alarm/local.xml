<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="converter" class="com.dianping.puma.biz.convert.ConverterImpl" />

    <bean id="memoryClientAlarmDataService"
          class="com.dianping.puma.biz.service.memory.MemoryClientAlarmDataService" />

    <bean id="memoryClientAlarmBenchmarkService"
          class="com.dianping.puma.biz.service.memory.MemoryClientAlarmBenchmarkService" />

    <bean id="memoryClientAlarmStrategyService"
          class="com.dianping.puma.biz.service.memory.MemoryClientAlarmStrategyService" />

    <bean id="memoryClientAlarmMetaService"
          class="com.dianping.puma.biz.service.memory.MemoryClientAlarmMetaService" />

    <bean id="pullTimeDelayAlarmArbiter" class="com.dianping.puma.alarm.arbitrate.PullTimeDelayAlarmArbiter" />
    <bean id="pushTimeDelayAlarmArbiter" class="com.dianping.puma.alarm.arbitrate.PushTimeDelayAlarmArbiter" />
    <bean id="chainedAlarmArbiter" class="com.dianping.puma.alarm.arbitrate.ChainedAlarmArbiter">
        <property name="arbiters">
            <list>
                <ref bean="pullTimeDelayAlarmArbiter" />
                <ref bean="pushTimeDelayAlarmArbiter" />
            </list>
        </property>
    </bean>

    <bean id="noAlarmRegulator" class="com.dianping.puma.alarm.regulate.NoAlarmRegulator" />
    <bean id="linearAlarmRegulator" class="com.dianping.puma.alarm.regulate.LinearAlarmRegulator" />
    <bean id="exponentialAlarmRegulator" class="com.dianping.puma.alarm.regulate.ExponentialAlarmRegulator" />
    <bean id="chainedAlarmRegulator" class="com.dianping.puma.alarm.regulate.ChainedAlarmRegulator">
        <property name="regulators">
            <list>
                <ref bean="noAlarmRegulator" />
                <ref bean="linearAlarmRegulator" />
                <ref bean="exponentialAlarmRegulator" />
            </list>
        </property>
    </bean>

    <bean id="emailAlarmNotifier" class="com.dianping.puma.alarm.notify.EmailAlarmNotifier" />
    <bean id="weChatAlarmNotifier" class="com.dianping.puma.alarm.notify.WeChatAlarmNotifier" />
    <bean id="smsAlarmNotifier" class="com.dianping.puma.alarm.notify.SmsAlarmNotifier" />
    <bean id="logAlarmNotifier" class="com.dianping.puma.alarm.notify.LogAlarmNotifier" />
    <bean id="chainedAlarmNotifier" class="com.dianping.puma.alarm.notify.ChainedAlarmNotifier">
        <property name="notifiers">
            <list>
                <ref bean="emailAlarmNotifier" />
                <ref bean="weChatAlarmNotifier" />
                <ref bean="smsAlarmNotifier" />
                <ref bean="logAlarmNotifier" />
            </list>
        </property>
    </bean>

    <bean id="pumaAlarmMonitor" class="com.dianping.puma.alarm.monitor.ScanningAlarmMonitor" init-method="start">
        <property name="pumaClientAlarmDataService" ref="memoryClientAlarmDataService" />
        <property name="pumaClientAlarmBenchmarkService" ref="memoryClientAlarmBenchmarkService" />
        <property name="pumaClientAlarmStrategyService" ref="memoryClientAlarmStrategyService" />
        <property name="pumaClientAlarmMetaService" ref="memoryClientAlarmMetaService" />
        <property name="arbiter" ref="chainedAlarmArbiter" />
        <property name="regulator" ref="chainedAlarmRegulator" />
        <property name="notifier" ref="chainedAlarmNotifier" />
        <property name="scanIntervalInSecond" value="5" />
    </bean>

</beans>